"0",""
"0",""
"0","#Impact of delay until the patients recieve their final diagnosis and the relapses"
"0",""
"0",""
"0","data_relapse_epi <- data_full_cleaned%>%"
"0","  select(code.pat, dx.event, dx.epi, type.epi.final, n.tot.recidives, motif_relapse, detail_relapse, date.1st.cs.su, date.dx.final)%>%"
"0","  mutate(dx.dicho = ifelse(dx.event != ""Epilepsy"" | is.na(dx.event), ""Non epileptic"", ""Epileptic""), "
"0","         relapses = case_when(n.tot.recidives == 0 ~ ""No relapse"","
"0","                              dx.dicho == ""Non epileptic"" & n.tot.recidives > 0 ~ ""Relapse"","
"0","                              detail_relapse == ""pas de ttt"" ~ ""Relapse"","
"0","                              detail_relapse == ""ttt ok et bonne compliance"" ~ ""Relapse"","
"0","                              detail_relapse == ""Probleme de compliance"" ~ ""Relapse"","
"0","                              detail_relapse == ""ttt ok taux infra ou ttt inadequat"" ~ ""Relapse"","
"0","                              motif_relapse == ""pas de recidives trouvees"" ~ ""No relapse"","
"0","                              TRUE ~ ""No relapse""),"
"0","         date.dx.final = as_date(date.dx.final),"
"0","         date.1st.cs.su = as_date(date.1st.cs.su),"
"0","         delay_dx = date.dx.final - date.1st.cs.su)%>%"
"0","  filter(dx.event == ""Epilepsy"","
"0","         delay_dx != is.na(delay_dx),"
"0","         delay_dx >= 0,"
"0","         delay_dx < 730)"
"0",""
"0","median_delay_epi <- median(data_relapse_epi$delay_dx)"
"0",""
"0","data_chi_epi <- data_relapse_epi%>%"
"0","      mutate(delay_dicho = ifelse(delay_dx < median_delay_epi, ""short"", ""long""))%>%"
"0","      select(code.pat, relapses, delay_dicho)%>%"
"0","  group_by(relapses, delay_dicho)%>%"
"0","  summarise(N = n())%>%"
"0","  spread(key = delay_dicho, value = N)"
"0","data_chi_epi <- as.data.frame(data_chi_epi[,2:3])"
"0",""
"0","chi_epi <- chisq.test(data_chi_epi) # p-value = 0.2354"
"0",""
"0",""
"0","# Same but taking all patients together"
"0",""
"0","data_relapse_all <- data_full_cleaned%>%"
"0","  select(code.pat, dx.event, dx.epi, type.epi.final, n.tot.recidives, motif_relapse, detail_relapse, date.1st.cs.su, date.dx.final)%>%"
"0","  mutate(dx.dicho = ifelse(dx.event != ""Epilepsy"" | is.na(dx.event), ""Non epileptic"", ""Epileptic""), "
"0","         relapses = case_when(n.tot.recidives == 0 ~ ""No relapse"","
"0","                              dx.dicho == ""Non epileptic"" & n.tot.recidives > 0 ~ ""Relapse"","
"0","                              detail_relapse == ""pas de ttt"" ~ ""Relapse"","
"0","                              detail_relapse == ""ttt ok et bonne compliance"" ~ ""Relapse"","
"0","                              detail_relapse == ""Probleme de compliance"" ~ ""Relapse"","
"0","                              detail_relapse == ""ttt ok taux infra ou ttt inadequat"" ~ ""Relapse"","
"0","                              motif_relapse == ""pas de recidives trouvees"" ~ ""No relapse"","
"0","                              TRUE ~ ""No relapse""),"
"0","         date.dx.final = as_date(date.dx.final),"
"0","         date.1st.cs.su = as_date(date.1st.cs.su),"
"0","         delay_dx = date.dx.final - date.1st.cs.su)%>%"
"0","  filter(delay_dx != is.na(delay_dx),"
"0","         delay_dx >= 0,"
"0","         delay_dx < 730)"
"0",""
"0","median_delay_all <- median(data_relapse_all$delay_dx)"
"0",""
"0","data_chi_all <- data_relapse_all%>%"
"0","  mutate(delay_dicho = ifelse(delay_dx < median_delay_all, ""short"", ""long""))%>%"
"0","  select(code.pat, relapses, delay_dicho)%>%"
"0","  group_by(relapses, delay_dicho)%>%"
"0","  summarise(N = n())%>%"
"0","  spread(key = delay_dicho, value = N)"
"0","data_chi_all <- as.data.frame(data_chi_all[,2:3])"
"0",""
"0","chi_all <- chisq.test(data_chi_all) # p-value = 0.001249"
"0",""
"0","# Visualization "
"0",""
"0","plot_all <- data_relapse_all%>%"
"0","  mutate(delay_dicho = ifelse(delay_dx < median_delay_all, ""short"", ""long""))%>%"
"0","  select(code.pat, relapses, delay_dicho)%>%"
"0","  group_by(relapses, delay_dicho)%>%"
"0","  summarise(N = n())"
"0",""
"0","plot_epi <- data_relapse_epi%>%"
"0","  mutate(delay_dicho = ifelse(delay_dx < median_delay_epi, ""short"", ""long""))%>%"
"0","  select(code.pat, relapses, delay_dicho)%>%"
"0","  group_by(relapses, delay_dicho)%>%"
"0","  summarise(N = n())"
"0",""
"0",""
"0","plot_all_pat <- plot_all%>%"
"0","  ggplot(aes(x = delay_dicho, y = N, fill = relapses))+"
"0","  geom_bar(stat = ""identity"", alpha = 0.8)+"
"0","  scale_fill_brewer(palette = ""Greens"")+"
"0","  theme_minimal()+"
"0","  labs(x = ""Delay first seizure - final diagnosis"", title = ""All patients"", fill = ""Relapses"")+"
"0","  coord_cartesian(ylim = c(0,135))"
"0",""
"0","plot_epi_pat <- plot_epi%>%"
"0","  ggplot(aes(x = delay_dicho, y = N, fill = relapses))+"
"0","  geom_bar(stat = ""identity"", alpha = 0.8)+"
"0","  scale_fill_brewer(palette = ""Reds"")+"
"0","  theme_minimal()+"
"0","  labs(x = ""Delay first seizure - final diagnosis"", title = ""Epileptic patients"", fill = ""Relapses"")+"
"0","  coord_cartesian(ylim = c(0,135))"
"0",""
"0","fig_delay_dx <- ggarrange(plot_all_pat, plot_epi_pat)"
"0",""
"0",""
"0","# Impact of the treatment delay"
"0","# epi"
"0",""
"0","data_relapse_epi_ttt <- data_full_cleaned%>%"
"0","  select(code.pat, dx.event, dx.epi, type.epi.final, n.tot.recidives, motif_relapse, detail_relapse, date.1st.cs.su, date.debut.tt)%>%"
"0","  mutate(dx.dicho = ifelse(dx.event != ""Epilepsy"" | is.na(dx.event), ""Non epileptic"", ""Epileptic""), "
"0","         relapses = case_when(n.tot.recidives == 0 ~ ""No relapse"","
"0","                              dx.dicho == ""Non epileptic"" & n.tot.recidives > 0 ~ ""Relapse"","
"0","                              detail_relapse == ""pas de ttt"" ~ ""Relapse"","
"0","                              detail_relapse == ""ttt ok et bonne compliance"" ~ ""Relapse"","
"0","                              detail_relapse == ""Probleme de compliance"" ~ ""Relapse"","
"0","                              detail_relapse == ""ttt ok taux infra ou ttt inadequat"" ~ ""Relapse"","
"0","                              motif_relapse == ""pas de recidives trouvees"" ~ ""No relapse"","
"0","                              TRUE ~ ""No relapse""),"
"0","         date.debut.tt = as_date(date.debut.tt),"
"0","         date.1st.cs.su = as_date(date.1st.cs.su),"
"0","         delay_tt = date.debut.tt - date.1st.cs.su)%>%"
"0","  filter(dx.event == ""Epilepsy"","
"0","         delay_tt != is.na(delay_tt),"
"0","         delay_tt >= 0,"
"0","         delay_tt < 730)"
"0",""
"0","median_delay_epi_tt <- median(data_relapse_epi_ttt$delay_tt)"
"0",""
"0","data_chi_epi_tt <- data_relapse_epi_ttt%>%"
"0","      mutate(delay_dicho = ifelse(delay_tt < median_delay_epi_tt, ""short"", ""long""))%>%"
"0","      select(code.pat, relapses, delay_dicho)%>%"
"0","  group_by(relapses, delay_dicho)%>%"
"0","  summarise(N = n())%>%"
"0","  spread(key = delay_dicho, value = N)"
"0","data_chi_epi_tt <- as.data.frame(data_chi_epi_tt[,2:3])"
"0",""
"0","chi_epi_tt <- chisq.test(data_chi_epi_tt) #  p-value = 0.07186"
"0",""
"0",""
"0","# Vizualisation treatment "
"0",""
"0","# plot_ttt_epi <- data_relapse_epi_ttt%>%"
"0","#       mutate(delay_dicho = ifelse(delay_tt < median_delay_epi_tt, ""short"", ""long""))%>%"
"0","#       select(code.pat, relapses, delay_dicho)%>%"
"0","#   group_by(relapses, delay_dicho)%>%"
"0","#   summarise(N = n())"
"0","# "
"0","# plot_ttt_epi%>%"
"0","#   ggplot(aes(x = delay_dicho, y = N, fill = relapses))+"
"0","#   geom_bar(stat = ""identity"")+"
"0","#   scale_fill_brewer(palette = ""Blues"")+"
"0","#   theme_minimal()+"
"0","#   labs(x = ""Delay first seizure - treatment instauration"", title = ""Epileptic patients"", fill = ""Relapses"")"
"0",""

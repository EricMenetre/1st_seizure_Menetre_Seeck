"0",""
"0","# Evolution of the diagnosis --> all patients"
"0","delay_dx_all <- data_full_cleaned%>%"
"0","  filter(!is.na(date.1st.cs.su),!is.na(date.dx.final))%>%"
"0","  mutate(delay.1st_epi_dx_fin = as_date(date.dx.final) - as_date(date.1st.cs.su))%>%"
"0","  filter(delay.1st_epi_dx_fin >= 0)%>%"
"0","  summarise(MEAN = round(mean(delay.1st_epi_dx_fin, na.rm = T),2),"
"0","            SD = round(sd(delay.1st_epi_dx_fin, na.rm = T),2))"
"0",""
"0","# Evolution of the diagnosis --> epi patients"
"0","delay_dx_epi <- data_full_cleaned%>%"
"0","  filter(dx.event == ""Epilepsy"")%>%"
"0","  filter(!is.na(date.1st.cs.su),!is.na(date.dx.final))%>%"
"0","  mutate(delay.1st_epi_dx_fin = as_date(date.dx.final) - as_date(date.1st.cs.su))%>%"
"0","  filter(delay.1st_epi_dx_fin >= 0)%>%"
"0","  summarise(MEAN = round(mean(delay.1st_epi_dx_fin, na.rm = T),2),"
"0","            SD = round(sd(delay.1st_epi_dx_fin, na.rm = T),2))"
"0",""
"0","# Evolution of the diagnosis --> non epi patients"
"0","delay_dx_non_epi <- data_full_cleaned%>%"
"0","  filter(dx.event != ""Epilepsy"" | is.na(dx.event))%>%"
"0","  filter(!is.na(date.1st.cs.su),!is.na(date.dx.final))%>%"
"0","  mutate(delay.1st_epi_dx_fin = as_date(date.dx.final) - as_date(date.1st.cs.su))%>%"
"0","  filter(delay.1st_epi_dx_fin >= 0)%>%"
"0","  mutate(dx_first_consult = ifelse(delay.1st_epi_dx_fin == 0, ""first_cs"", ""later""))%>%"
"0","  summarise(MEAN = round(mean(delay.1st_epi_dx_fin, na.rm = T),2),"
"0","            SD = round(sd(delay.1st_epi_dx_fin, na.rm = T),2))"
"0",""
"0","# Survival analysis investigating the differences in delay to reach the final diagnosis between epileptic and non-epileptic patients."
"0",""
"0","data_surv <- data_full_cleaned%>%"
"0","  select(code.pat, date.1st.cs.su, date.dx.final, dx.event, n.tot.recidives, motif_relapse, detail_relapse)%>%"
"0","  filter(!is.na(date.1st.cs.su), !is.na(date.dx.final))%>%"
"0","  mutate(date.1st.cs.su = as_date(date.1st.cs.su),"
"0","         date.dx.final  = as_date(date.dx.final),"
"0","         censored = ifelse(is.na(dx.event) | dx.event == ""Unknown"", ""censored"", ""diagnosed""),"
"0","         dx.dicho = ifelse(dx.event == ""Epilepsy"", ""epilepsy"", ""other""),"
"0","         delay_dx_final = date.dx.final-date.1st.cs.su)%>%"
"0","  filter(delay_dx_final >= 0)%>%"
"0","  select(-date.dx.final, -date.1st.cs.su, -dx.event)%>%"
"0","  mutate(detail_relapse = ifelse(is.na(detail_relapse), ""other"", detail_relapse),"
"0","         relapses = case_when(n.tot.recidives == 0 ~ ""no relapse"","
"0","                              detail_relapse == ""ttt ok et bonne compliance"" | detail_relapse == ""pas de ttt"" | detail_relapse == ""ttt ok taux infra ou ttt inadequat"" ~ ""relapse"","
"0","                              dx.dicho == ""epilepsy"" & n.tot.recidives > 0 & detail_relapse != ""ttt ok et bonne compliance"" ~ ""no relapse"","
"0","                              TRUE ~ ""relapse""))%>%"
"0","  select(-n.tot.recidives, -motif_relapse, -detail_relapse)%>%"
"0","  mutate(censored = as.factor(censored),"
"0","         dx.dicho = as.factor(dx.dicho),"
"0","         relapses = as.factor(relapses),"
"0","         delay_dx_final = as.numeric(delay_dx_final))%>%"
"0","  mutate(censored = as.numeric(censored),"
"0","         dx.dicho = as.numeric(dx.dicho),"
"0","         relapses = as.numeric(relapses))%>%"
"0","  filter(delay_dx_final <= 730)"
"0",""
"0","# Fitting of the model"
"0","fit <- survfit(Surv(delay_dx_final, censored) ~ dx.dicho, data = data_surv)"
"0",""
"0",""
"0","# Plot"
"0","ggsurvplot("
"0","  fit,                     # survfit object with calculated statistics."
"0","  pval = FALSE,"
"0","  conf.int = TRUE,         # show confidence intervals for "
"0","  # point estimaes of survival curves."
"0","  conf.int.style = ""step"",  # customize style of confidence intervals"
"0","  xlab = ""Time in days"",   # customize X axis label."
"0","  ggtheme = theme_light(), # customize plot and risk table with a theme."
"0","  # in legend of risk table."
"0","  ncensor.plot = FALSE,      # plot the number of censored subjects at time t"
"0","  surv.median.line = ""hv"",  # add the median survival pointer."
"0","  legend.labs = "
"0","    c(""Epilepsy"", ""Not epilepsy""),    # change legend labels."
"0","  palette = "
"0","    c(""#E7B800"", ""#2E9FDF""), # custom color palettes."
"0","  fun = ""event"""
"0","  )"
